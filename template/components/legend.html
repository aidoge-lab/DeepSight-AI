<!-- Legend Component -->
<div class="legend-container {{position | default: 'legend-right'}}" role="region" aria-label="Chart Legend">
  {{#if legend_title}}
  <div class="legend-header mb-sm">
    <h4 class="legend-title text-sm font-semibold">{{legend_title}}</h4>
  </div>
  {{/if}}
  
  <div class="legend-content">
    {{#if (eq type 'color')}}
    <!-- Color Legend -->
    <div class="color-legend">
      {{#each items}}
      <div class="legend-item flex items-center {{#if ../horizontal}}mr-md{{else}}mb-xs{{/if}}" data-series="{{id}}">
        {{#if clickable}}
        <button class="legend-button flex items-center w-full text-left hover:bg-secondary rounded px-xs py-xs transition-colors"
                data-action="toggle-series" 
                data-series="{{id}}"
                aria-pressed="{{#if visible}}true{{else}}false{{/if}}">
        {{/if}}
        
        <div class="legend-marker mr-sm flex-shrink-0">
          {{#if (eq marker_type 'circle')}}
          <div class="w-3 h-3 rounded-full border-2" 
               style="background-color: {{color}}; border-color: {{color}};"
               aria-hidden="true">
          </div>
          {{else if (eq marker_type 'square')}}
          <div class="w-3 h-3 border-2" 
               style="background-color: {{color}}; border-color: {{color}};"
               aria-hidden="true">
          </div>
          {{else if (eq marker_type 'line')}}
          <div class="w-4 h-0.5" 
               style="background-color: {{color}};"
               aria-hidden="true">
          </div>
          {{else}}
          <div class="w-3 h-3 rounded-full" 
               style="background-color: {{color}};"
               aria-hidden="true">
          </div>
          {{/if}}
        </div>
        
        <span class="legend-label text-sm {{#if visible}}text-primary{{else}}text-muted{{/if}}">
          {{label}}
        </span>
        
        {{#if show_value}}
        <span class="legend-value text-xs text-muted ml-auto">
          {{format_number value format}}{{#if unit}}{{unit}}{{/if}}
        </span>
        {{/if}}
        
        {{#if clickable}}
        </button>
        {{/if}}
      </div>
      {{/each}}
    </div>
    {{/if}}
    
    {{#if (eq type 'size')}}
    <!-- Size Legend -->
    <div class="size-legend">
      <div class="size-scale flex items-end justify-between mb-sm">
        {{#each size_markers}}
        <div class="size-marker flex flex-col items-center">
          <div class="w-{{size}} h-{{size}} rounded-full bg-accent mb-xs" aria-hidden="true"></div>
          <span class="text-xs text-muted">{{label}}</span>
        </div>
        {{/each}}
      </div>
      <div class="size-range text-center">
        <span class="text-xs text-muted">{{size_range.min}} - {{size_range.max}} {{size_range.unit}}</span>
      </div>
    </div>
    {{/if}}
    
    {{#if (eq type 'gradient')}}
    <!-- Gradient Legend -->
    <div class="gradient-legend">
      <div class="gradient-bar relative h-4 rounded mb-xs" 
           style="background: linear-gradient(to right, {{gradient_start}}, {{gradient_end}});"
           aria-hidden="true">
      </div>
      <div class="gradient-labels flex justify-between text-xs text-muted">
        <span>{{min_label}}</span>
        {{#if mid_label}}
        <span>{{mid_label}}</span>
        {{/if}}
        <span>{{max_label}}</span>
      </div>
      {{#if gradient_title}}
      <div class="gradient-title text-center mt-xs">
        <span class="text-xs font-medium">{{gradient_title}}</span>
      </div>
      {{/if}}
    </div>
    {{/if}}
    
    {{#if (eq type 'categorical')}}
    <!-- Categorical Legend -->
    <div class="categorical-legend">
      {{#each categories}}
      <div class="category-item flex items-center justify-between mb-xs p-xs rounded hover:bg-secondary transition-colors">
        <div class="flex items-center">
          <div class="category-marker w-4 h-4 mr-sm flex-shrink-0" 
               style="background-color: {{color}}; {{#if pattern}}background-image: {{pattern}};{{/if}}"
               aria-hidden="true">
          </div>
          <span class="text-sm">{{label}}</span>
        </div>
        {{#if count}}
        <span class="text-xs text-muted">{{count}}</span>
        {{/if}}
      </div>
      {{/each}}
    </div>
    {{/if}}
    
    {{#if (eq type 'custom')}}
    <!-- Custom Legend -->
    <div class="custom-legend">
      {{{custom_content}}}
    </div>
    {{/if}}
  </div>
  
  <!-- Legend Footer -->
  {{#if legend_footer}}
  <div class="legend-footer mt-sm pt-sm border-t">
    {{#if show_total}}
    <div class="legend-total text-xs text-muted">
      Total: {{format_number total format}}{{#if total_unit}}{{total_unit}}{{/if}}
    </div>
    {{/if}}
    
    {{#if interactive}}
    <div class="legend-actions mt-xs">
      <button class="btn btn-sm btn-ghost text-xs mr-xs" data-action="show-all">
        Show All
      </button>
      <button class="btn btn-sm btn-ghost text-xs" data-action="hide-all">
        Hide All
      </button>
    </div>
    {{/if}}
    
    {{#if legend_note}}
    <div class="legend-note text-xs text-muted italic mt-xs">
      {{legend_note}}
    </div>
    {{/if}}
  </div>
  {{/if}}
</div>

<!-- Note: Legend positioning styles should be added to components.css --> 