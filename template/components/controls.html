<!-- Controls Panel Component -->
<div class="controls-panel" role="region" aria-label="{{controls_title | default: 'Data Controls'}}">
  {{#if controls_title}}
  <div class="controls-header mb-md">
    <h3 class="text-lg font-semibold">{{controls_title}}</h3>
    {{#if controls_subtitle}}
    <p class="text-sm text-muted mt-xs">{{controls_subtitle}}</p>
    {{/if}}
  </div>
  {{/if}}
  
  <div class="controls-content">
    <div class="flex flex-wrap items-center gap-md">
      <!-- Date Range Picker -->
      {{#if date_range}}
      <div class="control-group">
        <label class="form-label text-xs font-medium">{{date_range.label | default: 'Date Range'}}</label>
        <div class="date-range-picker flex items-center">
          <input 
            type="date" 
            class="form-input text-sm"
            value="{{date_range.start}}"
            data-control="date-start"
            aria-label="Start date"
          >
          <span class="mx-sm text-muted">to</span>
          <input 
            type="date" 
            class="form-input text-sm"
            value="{{date_range.end}}"
            data-control="date-end"
            aria-label="End date"
          >
        </div>
      </div>
      {{/if}}
      
      <!-- Dropdown Filters -->
      {{#each dropdowns}}
      <div class="control-group">
        <label for="{{id}}" class="form-label text-xs font-medium">{{label}}</label>
        <select 
          id="{{id}}" 
          class="form-select text-sm"
          data-control="{{id}}"
          {{#if multiple}}multiple{{/if}}
          aria-label="{{label}}"
        >
          {{#if placeholder}}
          <option value="">{{placeholder}}</option>
          {{/if}}
          {{#each options}}
          <option value="{{value}}" {{#if selected}}selected{{/if}}>{{label}}</option>
          {{/each}}
        </select>
      </div>
      {{/each}}
      
      <!-- Search Input -->
      {{#if search}}
      <div class="control-group">
        <label for="search-control" class="form-label text-xs font-medium">{{search.label | default: 'Search'}}</label>
        <div class="search-input-wrapper relative">
          <input 
            type="search" 
            id="search-control"
            class="form-input text-sm pl-8"
            placeholder="{{search.placeholder}}"
            data-control="search"
            aria-label="{{search.label | default: 'Search'}}"
          >
          <svg class="absolute left-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            <path d="M7 12A5 5 0 1 0 7 2a5 5 0 0 0 0 10zM13 13l-3-3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      </div>
      {{/if}}
      
      <!-- Toggle Buttons -->
      {{#each toggles}}
      <div class="control-group">
        <label class="form-label text-xs font-medium">{{label}}</label>
        <div class="toggle-group btn-group" role="group" aria-label="{{label}}">
          {{#each options}}
          <button 
            class="btn btn-sm {{#if active}}btn-primary{{else}}btn-secondary{{/if}}"
            data-control="{{../id}}"
            data-value="{{value}}"
            aria-pressed="{{active}}"
          >
            {{label}}
          </button>
          {{/each}}
        </div>
      </div>
      {{/each}}
      
      <!-- Checkboxes -->
      {{#each checkboxes}}
      <div class="control-group">
        <div class="checkbox-wrapper flex items-center">
          <input 
            type="checkbox" 
            id="{{id}}"
            class="form-checkbox mr-sm"
            data-control="{{id}}"
            {{#if checked}}checked{{/if}}
            aria-describedby="{{id}}-desc"
          >
          <label for="{{id}}" class="text-sm font-medium cursor-pointer">{{label}}</label>
        </div>
        {{#if description}}
        <p id="{{id}}-desc" class="text-xs text-muted mt-xs">{{description}}</p>
        {{/if}}
      </div>
      {{/each}}
      
      <!-- Sliders/Range Inputs -->
      {{#each sliders}}
      <div class="control-group">
        <label for="{{id}}" class="form-label text-xs font-medium">{{label}}</label>
        <div class="slider-wrapper">
          <input 
            type="range" 
            id="{{id}}"
            class="form-range w-full"
            min="{{min}}"
            max="{{max}}"
            step="{{step | default: 1}}"
            value="{{value}}"
            data-control="{{id}}"
            aria-label="{{label}}"
            aria-describedby="{{id}}-value"
          >
          <div class="flex justify-between items-center mt-xs">
            <span class="text-xs text-muted">{{min}}</span>
            <span id="{{id}}-value" class="text-xs font-medium">{{value}}{{#if unit}}{{unit}}{{/if}}</span>
            <span class="text-xs text-muted">{{max}}</span>
          </div>
        </div>
      </div>
      {{/each}}
      
      <!-- Action Buttons -->
      {{#if actions}}
      <div class="control-actions ml-auto flex items-center gap-sm">
        {{#each actions}}
        <button 
          class="btn btn-sm {{style | default: 'btn-secondary'}}"
          data-action="{{action}}"
          {{#if disabled}}disabled{{/if}}
          aria-label="{{label}}"
        >
          {{#if icon}}
          <svg class="w-4 h-4 {{#if label}}mr-xs{{/if}}" viewBox="0 0 16 16" fill="none" aria-hidden="true">
            {{{icon}}}
          </svg>
          {{/if}}
          {{#if label}}{{label}}{{/if}}
        </button>
        {{/each}}
      </div>
      {{/if}}
    </div>
    
    <!-- Active Filters Display -->
    {{#if show_active_filters}}
    <div class="active-filters mt-md" id="active-filters" aria-live="polite">
      <div class="flex flex-wrap items-center gap-xs">
        <span class="text-xs font-medium text-muted">Active filters:</span>
        <!-- Active filter badges will be populated by JavaScript -->
        <div class="filter-badges flex flex-wrap gap-xs"></div>
        <button class="btn btn-sm btn-ghost text-xs clear-all-filters" data-action="clear-all">
          Clear all
        </button>
      </div>
    </div>
    {{/if}}
    
    <!-- Quick Filters -->
    {{#if quick_filters}}
    <div class="quick-filters mt-md">
      <div class="flex items-center gap-sm">
        <span class="text-xs font-medium text-muted">Quick filters:</span>
        {{#each quick_filters}}
        <button 
          class="btn btn-sm btn-ghost text-xs"
          data-quick-filter="{{id}}"
          data-filters="{{json filters}}"
        >
          {{label}}
        </button>
        {{/each}}
      </div>
    </div>
    {{/if}}
  </div>
  
  <!-- Controls Footer -->
  {{#if show_results_count}}
  <div class="controls-footer mt-md pt-md border-t">
    <div class="flex justify-between items-center">
      <span class="text-xs text-muted results-count" aria-live="polite">
        Showing <span class="font-medium" id="results-start">{{results.start | default: 0}}</span>-<span class="font-medium" id="results-end">{{results.end | default: 0}}</span> 
        of <span class="font-medium" id="results-total">{{results.total | default: 0}}</span> results
      </span>
      
      {{#if show_reset}}
      <button class="btn btn-sm btn-ghost text-xs reset-controls" data-action="reset">
        Reset all filters
      </button>
      {{/if}}
    </div>
  </div>
  {{/if}}
</div> 